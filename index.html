<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Geolocation API Demo</title>
  </head>
  <body>
    <p id="status">Waiting for location...</p>
    <p id="location"></p>
    <script>
      // Ask the user for permission to track their location
      function askPermission() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            // Display the user's current location
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            var locationText = 'Latitude: ' + latitude + ', Longitude: ' + longitude;
            document.getElementById('location').textContent = locationText;

            // Start tracking location in the background
            trackLocation();
          }, function(error) {
            // Display an error message
            var errorMessage = 'Error: ' + error.message;
            console.log(errorMessage);
            document.getElementById('status').textContent = errorMessage;
          });
        } else {
          // Geolocation API is not supported
          var errorMessage = 'Geolocation API is not supported';
          console.log(errorMessage);
          document.getElementById('status').textContent = errorMessage;
        }
      }

      // Start tracking location in the background using AJAX requests
      function trackLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(function(position) {
            // Send the location to the server using an AJAX request
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            var data = {latitude: latitude, longitude: longitude};
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'update_location.php');
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify(data));
          }, function(error) {
            // Display an error message
            var errorMessage = 'Error: ' + error.message;
            console.log(errorMessage);
            document.getElementById('status').textContent = errorMessage;
          });
        } else {
          // Geolocation API is not supported
          var errorMessage = 'Geolocation API is not supported';
          console.log(errorMessage);
          document.getElementById('status').textContent = errorMessage;
        }
      }

      // Ask the user for permission to track their location
      askPermission();
    </script>
  </body>
</html>
